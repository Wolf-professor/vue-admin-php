{"remainingRequest":"/Users/quan/code/vue-admin-php/view/node_modules/thread-loader/dist/cjs.js!/Users/quan/code/vue-admin-php/view/node_modules/babel-loader/lib/index.js!/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/quan/code/vue-admin-php/view/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/quan/code/vue-admin-php/view/src/views/adManage/adSite.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/quan/code/vue-admin-php/view/src/views/adManage/adSite.vue","mtime":1648609501798},{"path":"/Users/quan/code/vue-admin-php/view/babel.config.js","mtime":1648609501757},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js","mtime":1614678925383},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/thread-loader/dist/cjs.js","mtime":1614678926780},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/babel-loader/lib/index.js","mtime":1648609858414},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js","mtime":1614678925383},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/vue-loader/lib/index.js","mtime":1648609878333}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.split\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { adSiteList, adSiteAdList, adSiteSave, adSiteDelete } from \"../../api/ad/adSite\";\nimport draggable from \"vuedraggable\";\nvar formJson = {\n  site_id: \"\",\n  site_name: \"\",\n  describe: \"\",\n  ads: []\n};\nexport default {\n  data: function data() {\n    return {\n      query: {\n        site_id: \"\",\n        page: 1,\n        limit: 20\n      },\n      list: [],\n      adId: [],\n      adSelectList: [],\n      adList: {},\n      adListNoDataText: \"无数据\",\n      queryAdIdAsyncLoading: false,\n      total: 0,\n      loading: true,\n      index: null,\n      formName: null,\n      formMap: {\n        add: \"新增\",\n        edit: \"编辑\"\n      },\n      formLoading: false,\n      formVisible: false,\n      formData: formJson,\n      formRules: {\n        site_name: [{\n          required: true,\n          message: \"请输入广告位名称\",\n          trigger: \"blur\"\n        }]\n      },\n      deleteLoading: false\n    };\n  },\n  components: {\n    draggable: draggable\n  },\n  methods: {\n    onReset: function onReset() {\n      this.$router.push({\n        path: \"\"\n      });\n      this.query = {\n        site_id: \"\",\n        page: 1,\n        limit: 20\n      };\n      this.getList();\n    },\n    onSubmit: function onSubmit() {\n      this.$router.push({\n        path: \"\",\n        query: this.query\n      });\n      this.getList();\n    },\n    handleSizeChange: function handleSizeChange(val) {\n      this.query.limit = val;\n      this.getList();\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.query.page = val;\n      this.getList();\n    },\n    getList: function getList() {\n      var _this = this;\n\n      this.loading = true;\n      adSiteList(this.query).then(function (response) {\n        _this.loading = false;\n        _this.list = response.data.list || [];\n        _this.total = response.data.total || 0;\n      }).catch(function () {\n        _this.loading = false;\n        _this.list = [];\n        _this.total = 0;\n      });\n    },\n    // 异步查找广告\n    queryAdIdAsync: function queryAdIdAsync(adIdStr) {\n      var _this2 = this;\n\n      this.adListNoDataText = \"请确认广告状态是否正常\";\n\n      if (!adIdStr || adIdStr.charAt(adIdStr.length - 1) === \",\") {\n        this.adList = {};\n        return false;\n      }\n\n      var adIds = adIdStr.split(\",\");\n      this.formData.ads.forEach(function (item) {\n        adIds.forEach(function (obj, index) {\n          if (item.ad_id === parseInt(obj)) {\n            adIds.splice(index, 1);\n          }\n        });\n      });\n\n      if (adIds.length === 0) {\n        this.adListNoDataText = \"当前所有广告已存在列表中\";\n        return false;\n      }\n\n      this.queryAdIdAsyncLoading = true;\n      adSiteAdList({\n        ad_ids: adIds\n      }).then(function (response) {\n        _this2.queryAdIdAsyncLoading = false;\n        var list = response.data.list;\n\n        if (list) {\n          list.forEach(function (value) {\n            var has = false;\n\n            if (_this2.adList.length > 0) {\n              has = _this2.adList.some(function (item) {\n                return item.ad_id === value.ad_id;\n              });\n            }\n\n            if (!has) {\n              if (!_this2.adList.hasOwnProperty(value.ad_id)) {\n                _this2.adList[value.ad_id] = value;\n              }\n            }\n          });\n        } else {\n          _this2.adList = {};\n        }\n      }).catch(function () {\n        _this2.adList = {};\n        _this2.queryAdIdAsyncLoading = false;\n      });\n    },\n    handleAdSubmit: function handleAdSubmit() {\n      var _this3 = this;\n\n      if (this.adSelectList.length === 0) {\n        return false;\n      }\n\n      var ads = [];\n      this.adSelectList.map(function (item) {\n        if (_this3.adList.hasOwnProperty(item)) {\n          ads.push(_this3.adList[item]);\n        }\n      });\n      this.formData.ads = this.formData.ads.concat(ads);\n      this.adList = {};\n      this.adId = [];\n    },\n    handleAdClose: function handleAdClose(index) {\n      this.formData.ads.splice(index, 1);\n    },\n    handleAdChange: function handleAdChange(item) {\n      this.adSelectList = item;\n    },\n    // 刷新表单\n    resetForm: function resetForm() {\n      if (this.$refs[\"dataForm\"]) {\n        // 清空验证信息表单\n        this.$refs[\"dataForm\"].clearValidate(); // 刷新表单\n\n        this.$refs[\"dataForm\"].resetFields();\n      }\n    },\n    // 隐藏表单\n    hideForm: function hideForm() {\n      // 更改值\n      this.formVisible = !this.formVisible;\n      return true;\n    },\n    // 显示表单\n    handleForm: function handleForm(index, row) {\n      this.formVisible = true;\n      this.formData = JSON.parse(JSON.stringify(formJson));\n\n      if (row !== null) {\n        this.formData = Object.assign({}, row);\n      }\n\n      this.formName = \"add\";\n\n      if (index !== null) {\n        this.index = index;\n        this.formName = \"edit\";\n      }\n    },\n    formSubmit: function formSubmit() {\n      var _this4 = this;\n\n      this.$refs[\"dataForm\"].validate(function (valid) {\n        if (valid) {\n          _this4.formLoading = true;\n          var data = Object.assign({}, _this4.formData);\n          var ad_ids = [];\n          var ads = data.ads;\n          ads.forEach(function (value) {\n            ad_ids.push(value.ad_id);\n          });\n          data.ads = [];\n          data.ad_ids = ad_ids;\n          var addData = Object.assign({}, _this4.formData);\n          adSiteSave(data, _this4.formName).then(function (response) {\n            _this4.formLoading = false;\n\n            if (response.code) {\n              _this4.$message.error(response.message);\n\n              return false;\n            }\n\n            _this4.$message.success(\"操作成功\");\n\n            _this4.formVisible = false;\n\n            if (_this4.formName === \"add\") {\n              // 向头部添加数据\n              addData.site_id = response.data.site_id;\n\n              _this4.list.unshift(addData);\n            } else {\n              _this4.list.splice(_this4.index, 1, addData);\n            } // 刷新表单\n\n\n            _this4.resetForm();\n          }).catch(function () {\n            _this4.formLoading = false;\n          });\n        }\n      });\n    },\n    // 删除\n    handleDel: function handleDel(index, row) {\n      var _this5 = this;\n\n      if (row.site_id) {\n        this.$confirm(\"确认删除该记录吗?\", \"提示\", {\n          type: \"warning\"\n        }).then(function () {\n          var para = {\n            site_id: row.site_id\n          };\n          _this5.deleteLoading = false;\n          adSiteDelete(para).then(function (res) {\n            _this5.deleteLoading = false;\n\n            if (res.code) {\n              _this5.$message.error(res.message);\n\n              return false;\n            }\n\n            _this5.$message.success(\"删除成功\"); // 刷新数据\n\n\n            _this5.list.splice(index, 1);\n          }).catch(function () {\n            _this5.deleteLoading = false;\n          });\n        }).catch(function () {\n          _this5.$message.info(\"取消删除\");\n        });\n      }\n    }\n  },\n  filters: {},\n  mounted: function mounted() {\n    document.body.ondrop = function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n    };\n  },\n  created: function created() {\n    // 将参数拷贝进查询对象\n    var query = this.$route.query;\n    this.query = Object.assign(this.query, query);\n    this.query.limit = parseInt(this.query.limit); // 加载表格数据\n\n    this.getList();\n  }\n};",{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0HA,SACAA,UADA,EAEAC,YAFA,EAGAC,UAHA,EAIAC,YAJA;AAMA;AACA;AACAC,aADA;AAEAC,eAFA;AAGAC,cAHA;AAIAC;AAJA;AAMA;AACAC,MADA,kBACA;AACA;AACAC;AACAL,mBADA;AAEAM,eAFA;AAGAC;AAHA,OADA;AAMAC,cANA;AAOAC,cAPA;AAQAC,sBARA;AASAC,gBATA;AAUAC,6BAVA;AAWAC,kCAXA;AAYAC,cAZA;AAaAC,mBAbA;AAcAC,iBAdA;AAeAC,oBAfA;AAgBAC;AACAC,iBADA;AAEAC;AAFA,OAhBA;AAoBAC,wBApBA;AAqBAC,wBArBA;AAsBAC,wBAtBA;AAuBAC;AACAvB,oBACA;AACAwB,wBADA;AAEAC,6BAFA;AAGAC;AAHA,SADA;AADA,OAvBA;AAgCAC;AAhCA;AAkCA,GApCA;AAqCAC;AACAC;AADA,GArCA;AAwCAC;AACAC,WADA,qBACA;AACA;AACAC;AADA;AAGA;AACAjC,mBADA;AAEAM,eAFA;AAGAC;AAHA;AAKA;AACA,KAXA;AAYA2B,YAZA,sBAYA;AACA;AACAD,gBADA;AAEA5B;AAFA;AAIA;AACA,KAlBA;AAmBA8B,oBAnBA,4BAmBAC,GAnBA,EAmBA;AACA;AACA;AACA,KAtBA;AAuBAC,uBAvBA,+BAuBAD,GAvBA,EAuBA;AACA;AACA;AACA,KA1BA;AA2BAE,WA3BA,qBA2BA;AAAA;;AACA;AACA1C,6BACA2C,IADA,CACA;AACA;AACA;AACA;AACA,OALA,EAMAC,KANA,CAMA;AACA;AACA;AACA;AACA,OAVA;AAWA,KAxCA;AAyCA;AACAC,kBA1CA,0BA0CAC,OA1CA,EA0CA;AAAA;;AACA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACAC;AACA;AACAA;AACA;AACA,SAJA;AAKA,OANA;;AAOA;AACA;AACA;AACA;;AACA;AACA9C;AAAA+C;AAAA,SACAL,IADA,CACA;AACA;AACA;;AACA;AACA/B;AACA;;AACA;AACAqC;AACA;AACA,eAFA;AAGA;;AACA;AACA;AACA;AACA;AACA;AACA,WAZA;AAaA,SAdA,MAcA;AACA;AACA;AACA,OArBA,EAsBAL,KAtBA,CAsBA;AACA;AACA;AACA,OAzBA;AA0BA,KAvFA;AAwFAM,kBAxFA,4BAwFA;AAAA;;AACA;AACA;AACA;;AACA;AACA;AACA;AACA3C;AACA;AACA,OAJA;AAKA;AACA;AACA;AACA,KArGA;AAsGA4C,iBAtGA,yBAsGA/B,KAtGA,EAsGA;AACA;AACA,KAxGA;AAyGAgC,kBAzGA,0BAyGAC,IAzGA,EAyGA;AACA;AACA,KA3GA;AA4GA;AACAC,aA7GA,uBA6GA;AACA;AACA;AACA,+CAFA,CAGA;;AACA;AACA;AACA,KApHA;AAqHA;AACAC,YAtHA,sBAsHA;AACA;AACA;AACA;AACA,KA1HA;AA2HA;AACAC,cA5HA,sBA4HApC,KA5HA,EA4HAqC,GA5HA,EA4HA;AACA;AACA;;AACA;AACA;AACA;;AACA;;AACA;AACA;AACA;AACA;AACA,KAvIA;AAwIAC,cAxIA,wBAwIA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACAnD;AACAyC;AACA,WAFA;AAGAxC;AACAA;AACA;AACAN,4CACAyC,IADA,CACA;AACA;;AACA;AACA;;AACA;AACA;;AACA;;AACA;;AACA;AACA;AACAgB;;AACA;AACA,aAJA,MAIA;AACA;AACA,aAdA,CAeA;;;AACA;AACA,WAlBA,EAmBAf,KAnBA,CAmBA;AACA;AACA,WArBA;AAsBA;AACA,OAnCA;AAoCA,KA7KA;AA8KA;AACAgB,aA/KA,qBA+KAxC,KA/KA,EA+KAqC,GA/KA,EA+KA;AAAA;;AACA;AACA;AACAI;AADA,WAGAlB,IAHA,CAGA;AACA;AAAAvC;AAAA;AACA;AACAD,6BACAwC,IADA,CACA;AACA;;AACA;AACA;;AACA;AACA;;AACA,4CANA,CAOA;;;AACA;AACA,WAVA,EAWAC,KAXA,CAWA;AACA;AACA,WAbA;AAcA,SApBA,EAqBAA,KArBA,CAqBA;AACA;AACA,SAvBA;AAwBA;AACA;AA1MA,GAxCA;AAoPAkB,aApPA;AAqPAC,SArPA,qBAqPA;AACAC;AACAC;AACAA;AACA,KAHA;AAIA,GA1PA;AA2PAC,SA3PA,qBA2PA;AACA;AACA;AACA;AACA,kDAJA,CAKA;;AACA;AACA;AAlQA","names":["adSiteList","adSiteAdList","adSiteSave","adSiteDelete","site_id","site_name","describe","ads","data","query","page","limit","list","adId","adSelectList","adList","adListNoDataText","queryAdIdAsyncLoading","total","loading","index","formName","formMap","add","edit","formLoading","formVisible","formData","formRules","required","message","trigger","deleteLoading","components","draggable","methods","onReset","path","onSubmit","handleSizeChange","val","handleCurrentChange","getList","then","catch","queryAdIdAsync","adIdStr","adIds","ad_ids","has","handleAdSubmit","handleAdClose","handleAdChange","item","resetForm","hideForm","handleForm","row","formSubmit","addData","handleDel","type","filters","mounted","document","event","created"],"sourceRoot":"src/views/adManage","sources":["adSite.vue"],"sourcesContent":["<template>\n\n    <div>\n        <el-form :inline=\"true\" :model=\"query\" class=\"query-form\" size=\"mini\">\n            <el-form-item class=\"query-form-item\">\n                <el-input v-model=\"query.site_id\" placeholder=\"广告位id\"></el-input>\n            </el-form-item>\n            <el-form-item>\n                <el-button-group>\n                    <el-button type=\"primary\" icon=\"el-icon-refresh\" @click=\"onReset\"></el-button>\n                    <el-button type=\"primary\" icon=\"search\" @click=\"onSubmit\">查询</el-button>\n                    <el-button type=\"primary\" @click.native=\"handleForm(null,null)\">新增</el-button>\n                </el-button-group>\n            </el-form-item>\n        </el-form>\n        <el-table\n            v-loading=\"loading\"\n            :data=\"list\"\n            style=\"width: 100%;\">\n            <el-table-column\n                label=\"ID\"\n                prop=\"site_id\"\n                fixed>\n            </el-table-column>\n            <el-table-column\n                label=\"广告位名称\"\n                prop=\"site_name\"\n                fixed>\n            </el-table-column>\n            <el-table-column\n                label=\"广告位描述\"\n                prop=\"describe\"\n                with=\"300\"\n                :show-overflow-tooltip=\"true\">\n            </el-table-column>\n            <el-table-column\n                label=\"最后更新时间\"\n                prop=\"update_time\">\n                <template slot-scope=\"scope\">\n                    <i class=\"el-icon-time\"></i>\n                    <span>{{ scope.row.modified_time }}</span>\n                </template>\n            </el-table-column>\n            <el-table-column\n                label=\"操作\"\n                fixed=\"right\">\n                <template slot-scope=\"scope\">\n                    <el-button type=\"text\" size=\"small\" @click.native=\"handleForm(scope.$index, scope.row)\">编辑</el-button>\n                    <el-button type=\"text\" size=\"small\" @click.native=\"handleDel(scope.$index, scope.row)\">删除</el-button>\n                </template>\n            </el-table-column>\n        </el-table>\n\n        <el-pagination\n            :page-size=\"query.limit\"\n            @current-change=\"handleCurrentChange\"\n            layout=\"prev, pager, next\"\n            :total=\"total\">\n        </el-pagination>\n\n        <!--表单-->\n        <el-dialog\n            :title=\"formMap[formName]\"\n            :visible.sync=\"formVisible\"\n            :before-close=\"hideForm\"\n            width=\"85%\"\n            top=\"5vh\">\n            <el-form :model=\"formData\" :rules=\"formRules\" ref=\"dataForm\">\n                <el-form-item label=\"广告位名称\" prop=\"site_name\">\n                    <el-input v-model=\"formData.site_name\" auto-complete=\"off\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"包含广告（拖动更改排序）\" prop=\"describe\">\n                    <span style=\"color: red;\">注意：广告列表中红色背景为已禁用</span>\n                    <div class=\"remove-list-box\">\n                        <div class=\"remove-list\">\n\n                            <draggable element=\"ul\" v-model=\"formData.ads\">\n                                <li class=\"remove-list-item\" style=\"cursor: move;\" :style=\"{backgroundColor: item.status === 1 ? '#fff' : '#fef0f0', color: item.status === 1 ? '#606266' : '#f56c6c'}\" v-for=\"(item, index) in formData.ads\" :key=\"index\">\n                                    {{item.title}} - {{item.describe}}（ID：{{item.ad_id}}）\n                                    <i class=\"el-icon-close remove-list-close\" @click=\"handleAdClose(index)\"></i>\n                                </li>\n                            </draggable>\n\n                        </div>\n                        添加广告（填写广告ID，批量添加以英文逗号隔开，按顺序排列）\n                        <el-select\n                            size=\"mini\"\n                            v-model=\"adId\"\n                            multiple\n                            filterable\n                            remote\n                            reserve-keyword\n                            placeholder=\"输入广告ID查找\"\n                            :no-data-text=\"adListNoDataText\"\n                            :remote-method=\"queryAdIdAsync\"\n                            @change=\"handleAdChange\"\n                            :loading=\"queryAdIdAsyncLoading\">\n                            <el-option\n                                v-for=\"item in adList\"\n                                :key=\"item.ad_id\"\n                                :label=\"item.title\"\n                                :value=\"item.ad_id\">\n                            </el-option>\n                        </el-select>\n                        <el-button type=\"primary\" size=\"mini\" @click.native=\"handleAdSubmit()\" style=\"margin-left: 5px;\">插入</el-button>\n                    </div>\n                </el-form-item>\n                <el-form-item label=\"描述\" prop=\"describe\">\n                    <el-input v-model=\"formData.describe\" auto-complete=\"off\"></el-input>\n                </el-form-item>\n            </el-form>\n            <div slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click.native=\"hideForm\">取消</el-button>\n                <el-button type=\"primary\" @click.native=\"formSubmit()\" :loading=\"formLoading\">提交</el-button>\n            </div>\n        </el-dialog>\n\n    </div>\n\n</template>\n\n<script>\nimport {\n    adSiteList,\n    adSiteAdList,\n    adSiteSave,\n    adSiteDelete\n} from \"../../api/ad/adSite\";\nimport draggable from \"vuedraggable\";\nconst formJson = {\n    site_id: \"\",\n    site_name: \"\",\n    describe: \"\",\n    ads: []\n};\nexport default {\n    data() {\n        return {\n            query: {\n                site_id: \"\",\n                page: 1,\n                limit: 20\n            },\n            list: [],\n            adId: [],\n            adSelectList: [],\n            adList: {},\n            adListNoDataText: \"无数据\",\n            queryAdIdAsyncLoading: false,\n            total: 0,\n            loading: true,\n            index: null,\n            formName: null,\n            formMap: {\n                add: \"新增\",\n                edit: \"编辑\"\n            },\n            formLoading: false,\n            formVisible: false,\n            formData: formJson,\n            formRules: {\n                site_name: [\n                    {\n                        required: true,\n                        message: \"请输入广告位名称\",\n                        trigger: \"blur\"\n                    }\n                ]\n            },\n            deleteLoading: false\n        };\n    },\n    components: {\n        draggable\n    },\n    methods: {\n        onReset() {\n            this.$router.push({\n                path: \"\"\n            });\n            this.query = {\n                site_id: \"\",\n                page: 1,\n                limit: 20\n            };\n            this.getList();\n        },\n        onSubmit() {\n            this.$router.push({\n                path: \"\",\n                query: this.query\n            });\n            this.getList();\n        },\n        handleSizeChange(val) {\n            this.query.limit = val;\n            this.getList();\n        },\n        handleCurrentChange(val) {\n            this.query.page = val;\n            this.getList();\n        },\n        getList() {\n            this.loading = true;\n            adSiteList(this.query)\n                .then(response => {\n                    this.loading = false;\n                    this.list = response.data.list || [];\n                    this.total = response.data.total || 0;\n                })\n                .catch(() => {\n                    this.loading = false;\n                    this.list = [];\n                    this.total = 0;\n                });\n        },\n        // 异步查找广告\n        queryAdIdAsync(adIdStr) {\n            this.adListNoDataText = \"请确认广告状态是否正常\";\n            if (!adIdStr || adIdStr.charAt(adIdStr.length - 1) === \",\") {\n                this.adList = {};\n                return false;\n            }\n            let adIds = adIdStr.split(\",\");\n            this.formData.ads.forEach(item => {\n                adIds.forEach((obj, index) => {\n                    if (item.ad_id === parseInt(obj)) {\n                        adIds.splice(index, 1);\n                    }\n                });\n            });\n            if (adIds.length === 0) {\n                this.adListNoDataText = \"当前所有广告已存在列表中\";\n                return false;\n            }\n            this.queryAdIdAsyncLoading = true;\n            adSiteAdList({ ad_ids: adIds })\n                .then(response => {\n                    this.queryAdIdAsyncLoading = false;\n                    let list = response.data.list;\n                    if (list) {\n                        list.forEach(value => {\n                            let has = false;\n                            if (this.adList.length > 0) {\n                                has = this.adList.some(item => {\n                                    return item.ad_id === value.ad_id;\n                                });\n                            }\n                            if (!has) {\n                                if (!this.adList.hasOwnProperty(value.ad_id)) {\n                                    this.adList[value.ad_id] = value;\n                                }\n                            }\n                        });\n                    } else {\n                        this.adList = {};\n                    }\n                })\n                .catch(() => {\n                    this.adList = {};\n                    this.queryAdIdAsyncLoading = false;\n                });\n        },\n        handleAdSubmit() {\n            if (this.adSelectList.length === 0) {\n                return false;\n            }\n            let ads = [];\n            this.adSelectList.map(item => {\n                if (this.adList.hasOwnProperty(item)) {\n                    ads.push(this.adList[item]);\n                }\n            });\n            this.formData.ads = this.formData.ads.concat(ads);\n            this.adList = {};\n            this.adId = [];\n        },\n        handleAdClose(index) {\n            this.formData.ads.splice(index, 1);\n        },\n        handleAdChange(item) {\n            this.adSelectList = item;\n        },\n        // 刷新表单\n        resetForm() {\n            if (this.$refs[\"dataForm\"]) {\n                // 清空验证信息表单\n                this.$refs[\"dataForm\"].clearValidate();\n                // 刷新表单\n                this.$refs[\"dataForm\"].resetFields();\n            }\n        },\n        // 隐藏表单\n        hideForm() {\n            // 更改值\n            this.formVisible = !this.formVisible;\n            return true;\n        },\n        // 显示表单\n        handleForm(index, row) {\n            this.formVisible = true;\n            this.formData = JSON.parse(JSON.stringify(formJson));\n            if (row !== null) {\n                this.formData = Object.assign({}, row);\n            }\n            this.formName = \"add\";\n            if (index !== null) {\n                this.index = index;\n                this.formName = \"edit\";\n            }\n        },\n        formSubmit() {\n            this.$refs[\"dataForm\"].validate(valid => {\n                if (valid) {\n                    this.formLoading = true;\n                    let data = Object.assign({}, this.formData);\n                    let ad_ids = [];\n                    let ads = data.ads;\n                    ads.forEach(function(value) {\n                        ad_ids.push(value.ad_id);\n                    });\n                    data.ads = [];\n                    data.ad_ids = ad_ids;\n                    let addData = Object.assign({}, this.formData);\n                    adSiteSave(data, this.formName)\n                        .then(response => {\n                            this.formLoading = false;\n                            if (response.code) {\n                                this.$message.error(response.message);\n                                return false;\n                            }\n                            this.$message.success(\"操作成功\");\n                            this.formVisible = false;\n                            if (this.formName === \"add\") {\n                                // 向头部添加数据\n                                addData.site_id = response.data.site_id;\n                                this.list.unshift(addData);\n                            } else {\n                                this.list.splice(this.index, 1, addData);\n                            }\n                            // 刷新表单\n                            this.resetForm();\n                        })\n                        .catch(() => {\n                            this.formLoading = false;\n                        });\n                }\n            });\n        },\n        // 删除\n        handleDel(index, row) {\n            if (row.site_id) {\n                this.$confirm(\"确认删除该记录吗?\", \"提示\", {\n                    type: \"warning\"\n                })\n                    .then(() => {\n                        let para = { site_id: row.site_id };\n                        this.deleteLoading = false;\n                        adSiteDelete(para)\n                            .then(res => {\n                                this.deleteLoading = false;\n                                if (res.code) {\n                                    this.$message.error(res.message);\n                                    return false;\n                                }\n                                this.$message.success(\"删除成功\");\n                                // 刷新数据\n                                this.list.splice(index, 1);\n                            })\n                            .catch(() => {\n                                this.deleteLoading = false;\n                            });\n                    })\n                    .catch(() => {\n                        this.$message.info(\"取消删除\");\n                    });\n            }\n        }\n    },\n    filters: {},\n    mounted() {\n        document.body.ondrop = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n        };\n    },\n    created() {\n        // 将参数拷贝进查询对象\n        let query = this.$route.query;\n        this.query = Object.assign(this.query, query);\n        this.query.limit = parseInt(this.query.limit);\n        // 加载表格数据\n        this.getList();\n    }\n};\n</script>\n\n<style type=\"text/scss\" lang=\"scss\">\n</style>\n"]}]}
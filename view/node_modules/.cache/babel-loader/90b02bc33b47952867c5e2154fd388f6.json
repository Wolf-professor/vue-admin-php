{"remainingRequest":"/Users/quan/code/vue-admin-php/view/node_modules/thread-loader/dist/cjs.js!/Users/quan/code/vue-admin-php/view/node_modules/babel-loader/lib/index.js!/Users/quan/code/vue-admin-php/view/node_modules/eslint-loader/index.js??ref--13-0!/Users/quan/code/vue-admin-php/view/src/role.js","dependencies":[{"path":"/Users/quan/code/vue-admin-php/view/src/role.js","mtime":1648609501793},{"path":"/Users/quan/code/vue-admin-php/view/babel.config.js","mtime":1648609501757},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js","mtime":1614678925383},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/thread-loader/dist/cjs.js","mtime":1614678926780},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/babel-loader/lib/index.js","mtime":1648609858414},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/eslint-loader/index.js","mtime":1614678921459}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/quan/code/vue-admin-php/view/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport router from \"./router/index\";\nimport store from \"./store/index\";\nimport NProgress from \"nprogress\"; // Progress 进度条\n\nimport \"nprogress/nprogress.css\"; // Progress 进度条样式\n\nimport { getAdminId } from \"./utils/auth\"; // 验权\n\nimport { Message } from \"element-ui\";\nimport { asyncRouterMap } from \"./router/index\"; // permissiom judge\n\nfunction hasRole(authRules, permissionAuthRules) {\n  if (!authRules || authRules.length <= 0) {\n    return false;\n  }\n\n  if (authRules.indexOf(\"admin\") >= 0) return true; // admin权限 直接通过\n\n  if (!permissionAuthRules) return true;\n  return authRules.some(function (role) {\n    return permissionAuthRules.indexOf(role) >= 0;\n  });\n}\n/**\n * 通过meta.role判断是否与当前用户权限匹配\n * @param authRules\n * @param route\n */\n\n\nfunction hasRouterRole(authRules, route) {\n  if (authRules.indexOf(\"admin\") >= 0 || !route.meta || !route.meta.authRule) {\n    return true;\n  }\n\n  return authRules.some(function (authRule) {\n    return route.meta.authRule.indexOf(authRule) >= 0;\n  });\n}\n/**\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\n * @param asyncRouterMap\n * @param authRules\n */\n\n\nfunction filterAsyncRouter(asyncRouterMap, authRules) {\n  var accessedRouters = asyncRouterMap.filter(function (route) {\n    if (hasRouterRole(authRules, route)) {\n      if (route.children && route.children.length) {\n        route.children = filterAsyncRouter(route.children, authRules);\n      }\n\n      return true;\n    }\n\n    return false;\n  });\n  return accessedRouters;\n} // register global progress.\n\n\nvar whiteList = [\"/login\", \"/401\", \"/404\", \"/500\"]; // 不重定向白名单\n\nrouter.beforeEach(function (to, from, next) {\n  NProgress.start(); // 开启Progress\n\n  if (whiteList.indexOf(to.path) !== -1) {\n    // 在免登录白名单，直接进入\n    next();\n    return;\n  }\n\n  var adminId = getAdminId();\n\n  if (adminId !== \"undefined\" && adminId !== \"\" && adminId) {\n    // 判断是否有token\n    if (to.path === \"/login\") {\n      next({\n        path: \"/\"\n      });\n      NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\n\n      return;\n    }\n\n    if (!store.getters.userName && (!store.getters.authRules || store.getters.authRules.length === 0)) {\n      // 判断当前用户是否已拉取完用户信息\n      store.dispatch(\"userInfo\").then(function (data) {\n        // 拉取user_info\n        var authRules = data.authRules || [];\n\n        if (!(authRules instanceof Array) || authRules.length === 0) {\n          Message.error(\"权限验证失败，请联系管理员~\");\n          next({\n            path: \"/401\",\n            query: {\n              noGoBack: true\n            }\n          });\n          NProgress.done();\n          return;\n        }\n\n        var accessedRouters = filterAsyncRouter(asyncRouterMap, authRules); // 生成可访问的路由表\n\n        router.addRoutes(accessedRouters); // 动态添加可访问路由表\n\n        next(_objectSpread({}, to)); // hack方法 确保addRoutes已完成\n        // 设置左边导航栏\n\n        store.dispatch(\"filterRouter\", {\n          accessedRouters: accessedRouters\n        }).then(function () {});\n      }).catch(function () {\n        store.dispatch(\"fedLogout\").then(function () {\n          Message.error(\"验证失败,请重新登录\");\n          var redirect = to.fullPath;\n          store.dispatch(\"loginOut\").then(function () {\n            next({\n              path: \"/login\",\n              query: {\n                redirect: redirect\n              }\n            });\n          });\n        });\n      });\n      return;\n    } // 没有动态改变权限的需求可直接next() 删除下方权限判断 ↓\n\n\n    if (hasRole(store.getters.authRules, to.meta.authRule)) {\n      next(); //\n\n      return;\n    }\n\n    next({\n      path: \"/401\",\n      query: {\n        noGoBack: true\n      }\n    });\n    NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\n\n    return;\n  }\n\n  var redirect = to.fullPath;\n  store.dispatch(\"loginOut\").then(function () {\n    next({\n      path: \"/login\",\n      query: {\n        redirect: redirect\n      }\n    });\n  }); // 否则全部重定向到登录页\n\n  NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\n});\nrouter.afterEach(function () {\n  NProgress.done(); // 结束Progress\n});",{"version":3,"sources":["/Users/quan/code/vue-admin-php/view/src/role.js"],"names":["router","store","NProgress","getAdminId","Message","asyncRouterMap","hasRole","authRules","permissionAuthRules","length","indexOf","some","role","hasRouterRole","route","meta","authRule","filterAsyncRouter","accessedRouters","filter","children","whiteList","beforeEach","to","from","next","start","path","adminId","done","getters","userName","dispatch","then","data","Array","error","query","noGoBack","addRoutes","catch","redirect","fullPath","afterEach"],"mappings":"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","sourcesContent":["import router from \"./router/index\";\nimport store from \"./store/index\";\nimport NProgress from \"nprogress\"; // Progress 进度条\nimport \"nprogress/nprogress.css\"; // Progress 进度条样式\nimport { getAdminId } from \"./utils/auth\"; // 验权\nimport { Message } from \"element-ui\";\nimport { asyncRouterMap } from \"./router/index\";\n// permissiom judge\nfunction hasRole(authRules, permissionAuthRules) {\n    if (!authRules || authRules.length <= 0) {\n        return false;\n    }\n    if (authRules.indexOf(\"admin\") >= 0) return true; // admin权限 直接通过\n    if (!permissionAuthRules) return true;\n    return authRules.some(role => permissionAuthRules.indexOf(role) >= 0);\n}\n\n/**\n * 通过meta.role判断是否与当前用户权限匹配\n * @param authRules\n * @param route\n */\nfunction hasRouterRole(authRules, route) {\n    if (\n        authRules.indexOf(\"admin\") >= 0 ||\n        !route.meta ||\n        !route.meta.authRule\n    ) {\n        return true;\n    }\n    return authRules.some(\n        authRule => route.meta.authRule.indexOf(authRule) >= 0\n    );\n}\n\n/**\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\n * @param asyncRouterMap\n * @param authRules\n */\nfunction filterAsyncRouter(asyncRouterMap, authRules) {\n    const accessedRouters = asyncRouterMap.filter(route => {\n        if (hasRouterRole(authRules, route)) {\n            if (route.children && route.children.length) {\n                route.children = filterAsyncRouter(route.children, authRules);\n            }\n            return true;\n        }\n        return false;\n    });\n    return accessedRouters;\n}\n\n// register global progress.\nconst whiteList = [\"/login\", \"/401\", \"/404\", \"/500\"]; // 不重定向白名单\nrouter.beforeEach((to, from, next) => {\n    NProgress.start(); // 开启Progress\n    if (whiteList.indexOf(to.path) !== -1) {\n        // 在免登录白名单，直接进入\n        next();\n        return;\n    }\n    let adminId = getAdminId();\n    if (adminId !== \"undefined\" && adminId !== \"\" && adminId) {\n        // 判断是否有token\n        if (to.path === \"/login\") {\n            next({ path: \"/\" });\n            NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\n            return;\n        }\n        if (\n            !store.getters.userName &&\n            (!store.getters.authRules || store.getters.authRules.length === 0)\n        ) {\n            // 判断当前用户是否已拉取完用户信息\n            store\n                .dispatch(\"userInfo\")\n                .then(data => {\n                    // 拉取user_info\n                    const authRules = data.authRules || [];\n                    if (\n                        !(authRules instanceof Array) ||\n                        authRules.length === 0\n                    ) {\n                        Message.error(\"权限验证失败，请联系管理员~\");\n                        next({\n                            path: \"/401\",\n                            query: { noGoBack: true }\n                        });\n                        NProgress.done();\n                        return;\n                    }\n                    let accessedRouters = filterAsyncRouter(\n                        asyncRouterMap,\n                        authRules\n                    );\n                    // 生成可访问的路由表\n                    router.addRoutes(accessedRouters); // 动态添加可访问路由表\n                    next({ ...to }); // hack方法 确保addRoutes已完成\n                    // 设置左边导航栏\n                    store\n                        .dispatch(\"filterRouter\", { accessedRouters })\n                        .then(() => {});\n                })\n                .catch(() => {\n                    store.dispatch(\"fedLogout\").then(() => {\n                        Message.error(\"验证失败,请重新登录\");\n                        let redirect = to.fullPath;\n                        store.dispatch(\"loginOut\").then(() => {\n                            next({\n                                path: \"/login\",\n                                query: { redirect: redirect }\n                            });\n                        });\n                    });\n                });\n            return;\n        }\n        // 没有动态改变权限的需求可直接next() 删除下方权限判断 ↓\n        if (hasRole(store.getters.authRules, to.meta.authRule)) {\n            next(); //\n            return;\n        }\n        next({\n            path: \"/401\",\n            query: { noGoBack: true }\n        });\n        NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\n        return;\n    }\n    let redirect = to.fullPath;\n    store.dispatch(\"loginOut\").then(() => {\n        next({\n            path: \"/login\",\n            query: { redirect: redirect }\n        });\n    }); // 否则全部重定向到登录页\n    NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\n});\n\nrouter.afterEach(() => {\n    NProgress.done(); // 结束Progress\n});\n"]}]}
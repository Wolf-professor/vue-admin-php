{"remainingRequest":"/Users/quan/code/vue-admin-php/view/node_modules/thread-loader/dist/cjs.js!/Users/quan/code/vue-admin-php/view/node_modules/babel-loader/lib/index.js!/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/quan/code/vue-admin-php/view/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/quan/code/vue-admin-php/view/src/components/Tinymce/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/quan/code/vue-admin-php/view/src/components/Tinymce/index.vue","mtime":1648609501787},{"path":"/Users/quan/code/vue-admin-php/view/babel.config.js","mtime":1648609501757},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js","mtime":1614678925383},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/thread-loader/dist/cjs.js","mtime":1614678926780},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/babel-loader/lib/index.js","mtime":1648609858414},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js","mtime":1614678925383},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/vue-loader/lib/index.js","mtime":1648609878333}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\nimport plugins from \"./plugins\";\nimport toolbar from \"./toolbar\";\nimport { qiuNiuUpToken, createFile } from \"../../api/file/upload\";\nexport default {\n  name: \"Tinymce\",\n  props: {\n    id: {\n      type: String,\n      default: function _default() {\n        return \"vue-tinymce-\" + +new Date() + ((Math.random() * 1000).toFixed(0) + \"\");\n      }\n    },\n    value: {\n      type: String,\n      default: \"\"\n    },\n    toolbar: {\n      type: Array,\n      required: false,\n      default: function _default() {\n        return [];\n      }\n    },\n    menubar: {\n      type: String,\n      default: \"file edit insert view format table\"\n    },\n    height: {\n      type: Number,\n      required: false,\n      default: 360\n    }\n  },\n  data: function data() {\n    return {\n      hasChange: false,\n      hasInit: false,\n      tinymceId: this.id,\n      fullscreen: false\n    };\n  },\n  computed: {},\n  watch: {\n    value: function value(val) {\n      var _this2 = this;\n\n      if (!this.hasChange && this.hasInit) {\n        this.$nextTick(function () {\n          return window.tinymce.get(_this2.tinymceId).setContent(val || \"\");\n        });\n      }\n    }\n  },\n  mounted: function mounted() {\n    this.initTinymce();\n  },\n  activated: function activated() {\n    this.initTinymce();\n  },\n  deactivated: function deactivated() {\n    this.destroyTinymce();\n  },\n  destroyed: function destroyed() {\n    this.destroyTinymce();\n  },\n  methods: {\n    initTinymce: function initTinymce() {\n      var _this3 = this;\n\n      var _this = this;\n\n      window.tinymce.init({\n        language: \"zh_CN\",\n        selector: \"#\".concat(this.tinymceId),\n        convert_urls: false,\n        // 让图片不自动设置成相对路径\n        height: this.height,\n        body_class: \"panel-body \",\n        object_resizing: false,\n        toolbar: this.toolbar.length > 0 ? this.toolbar : toolbar,\n        menubar: this.menubar,\n        plugins: plugins,\n        end_container_on_empty_block: true,\n        powerpaste_word_import: \"clean\",\n        code_dialog_height: 450,\n        code_dialog_width: 1000,\n        advlist_bullet_styles: \"square\",\n        advlist_number_styles: \"default\",\n        imagetools_cors_hosts: [\"www.tinymce.com\", \"codepen.io\"],\n        default_link_target: \"_blank\",\n        link_title: false,\n        nonbreaking_force_tab: true,\n        // inserting nonbreaking space &nbsp; need Nonbreaking Space Plugin\n        init_instance_callback: function init_instance_callback(editor) {\n          if (_this.value) {\n            editor.setContent(_this.value);\n          }\n\n          _this.hasInit = true;\n          editor.on(\"NodeChange Change KeyUp SetContent\", function () {\n            _this3.hasChange = true;\n\n            _this3.$emit(\"input\", editor.getContent());\n          });\n        },\n        setup: function setup(editor) {\n          editor.on(\"FullscreenStateChanged\", function (e) {\n            _this.fullscreen = e.state;\n          });\n        },\n        // 整合七牛上传\n        // images_dataimg_filter(img) {\n        //   setTimeout(() => {\n        //     const $image = $(img);\n        //     $image.removeAttr('width');\n        //     $image.removeAttr('height');\n        //     if ($image[0].height && $image[0].width) {\n        //       $image.attr('data-wscntype', 'image');\n        //       $image.attr('data-wscnh', $image[0].height);\n        //       $image.attr('data-wscnw', $image[0].width);\n        //       $image.addClass('wscnph');\n        //     }\n        //   }, 0);\n        //   return img\n        // },\n        images_upload_handler: function images_upload_handler(blobInfo, success, failure, progress) {\n          progress(0);\n          qiuNiuUpToken().then(function (response) {\n            if (response.code > 0) {\n              failure(\"出现未知问题，刷新页面\");\n              return;\n            }\n\n            var url = response.data.upload_url;\n            var formData = new FormData();\n            formData.append(\"token\", response.data.up_token);\n            formData.append(\"file\", blobInfo.blob());\n            var domain = response.data.domain;\n            createFile(url, formData).then(function (response) {\n              if (response.data.key) {\n                var path_url = domain + \"/\" + response.data.key;\n                success(path_url);\n                progress(100);\n                return;\n              }\n\n              failure(\"上传出错\");\n            }).catch(function () {\n              failure(\"上传出错\");\n            });\n          }).catch(function (err) {\n            failure(\"出现未知问题，刷新页面\");\n            console.log(err);\n          });\n        }\n      });\n    },\n    destroyTinymce: function destroyTinymce() {\n      if (window.tinymce.get(this.tinymceId)) {\n        window.tinymce.get(this.tinymceId).destroy();\n      }\n    },\n    setContent: function setContent(value) {\n      window.tinymce.get(this.tinymceId).setContent(value);\n    },\n    getContent: function getContent() {\n      window.tinymce.get(this.tinymceId).getContent();\n    }\n  }\n};",{"version":3,"mappings":";;;;;;;AAOA;AACA;AACA;AAEA;AACAA,iBADA;AAEAC;AACAC;AACAC,kBADA;AAEAC;AACA,eACA,iBACA,WADA,IAEA,sCAFA,CADA;AAKA;AARA,KADA;AAWAC;AACAF,kBADA;AAEAC;AAFA,KAXA;AAeAE;AACAH,iBADA;AAEAI,qBAFA;AAGAH,aAHA,sBAGA;AACA;AACA;AALA,KAfA;AAsBAI;AACAL,kBADA;AAEAC;AAFA,KAtBA;AA0BAK;AACAN,kBADA;AAEAI,qBAFA;AAGAH;AAHA;AA1BA,GAFA;AAkCAM,MAlCA,kBAkCA;AACA;AACAC,sBADA;AAEAC,oBAFA;AAGAC,wBAHA;AAIAC;AAJA;AAMA,GAzCA;AA0CAC,cA1CA;AA2CAC;AACAX,SADA,iBACAY,GADA,EACA;AAAA;;AACA;AACA;AAAA,iBACAC,0DADA;AAAA;AAGA;AACA;AAPA,GA3CA;AAoDAC,SApDA,qBAoDA;AACA;AACA,GAtDA;AAuDAC,WAvDA,uBAuDA;AACA;AACA,GAzDA;AA0DAC,aA1DA,yBA0DA;AACA;AACA,GA5DA;AA6DAC,WA7DA,uBA6DA;AACA;AACA,GA/DA;AAgEAC;AACAC,eADA,yBACA;AAAA;;AACA;;AACAN;AACAO,yBADA;AAEAC,4CAFA;AAGAC,2BAHA;AAGA;AACAlB,2BAJA;AAKAmB,iCALA;AAMAC,8BANA;AAOAvB,iEAPA;AAQAE,6BARA;AASAsB,wBATA;AAUAC,0CAVA;AAWAC,uCAXA;AAYAC,+BAZA;AAaAC,+BAbA;AAcAC,uCAdA;AAeAC,wCAfA;AAgBAC,gEAhBA;AAiBAC,qCAjBA;AAkBAC,yBAlBA;AAmBAC,mCAnBA;AAmBA;AACAC;AACA;AACAC;AACA;;AACAC;AACAD;AACA;;AACA;AACA,WAHA;AAIA,SA7BA;AA8BAE,aA9BA,iBA8BAF,MA9BA,EA8BA;AACAA;AACAC;AACA,WAFA;AAGA,SAlCA;AAmCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAE,6BAlDA,iCAkDAC,QAlDA,EAkDAC,OAlDA,EAkDAC,OAlDA,EAkDAC,QAlDA,EAkDA;AACAA;AACAC,0BACAC,IADA,CACA;AACA;AACAH;AACA;AACA;;AACA;AACA;AACAI;AACAA;AACA;AACAC,sCACAF,IADA,CACA;AACA;AACA,+BACAG,gCADA;AAEAP;AACAE;AACA;AACA;;AACAD;AACA,aAVA,EAWAO,KAXA,CAWA;AACAP;AACA,aAbA;AAcA,WAzBA,EA0BAO,KA1BA,CA0BA;AACAP;AACAQ;AACA,WA7BA;AA8BA;AAlFA;AAoFA,KAvFA;AAwFAC,kBAxFA,4BAwFA;AACA;AACAvC;AACA;AACA,KA5FA;AA6FAwC,cA7FA,sBA6FArD,KA7FA,EA6FA;AACAa;AACA,KA/FA;AAgGAyC,cAhGA,wBAgGA;AACAzC;AACA;AAlGA;AAhEA","names":["name","props","id","type","default","value","toolbar","required","menubar","height","data","hasChange","hasInit","tinymceId","fullscreen","computed","watch","val","window","mounted","activated","deactivated","destroyed","methods","initTinymce","language","selector","convert_urls","body_class","object_resizing","plugins","end_container_on_empty_block","powerpaste_word_import","code_dialog_height","code_dialog_width","advlist_bullet_styles","advlist_number_styles","imagetools_cors_hosts","default_link_target","link_title","nonbreaking_force_tab","init_instance_callback","editor","_this","setup","images_upload_handler","blobInfo","success","failure","progress","qiuNiuUpToken","then","formData","createFile","domain","catch","console","destroyTinymce","setContent","getContent"],"sourceRoot":"src/components/Tinymce","sources":["index.vue"],"sourcesContent":["<template>\n  <div :class=\"{fullscreen:fullscreen}\" class=\"tinymce-container editor-container\">\n    <textarea :id=\"tinymceId\" class=\"tinymce-textarea\"/>\n  </div>\n</template>\n\n<script>\nimport plugins from \"./plugins\";\nimport toolbar from \"./toolbar\";\nimport { qiuNiuUpToken, createFile } from \"../../api/file/upload\";\n\nexport default {\n    name: \"Tinymce\",\n    props: {\n        id: {\n            type: String,\n            default: function() {\n                return (\n                    \"vue-tinymce-\" +\n                    +new Date() +\n                    ((Math.random() * 1000).toFixed(0) + \"\")\n                );\n            }\n        },\n        value: {\n            type: String,\n            default: \"\"\n        },\n        toolbar: {\n            type: Array,\n            required: false,\n            default() {\n                return [];\n            }\n        },\n        menubar: {\n            type: String,\n            default: \"file edit insert view format table\"\n        },\n        height: {\n            type: Number,\n            required: false,\n            default: 360\n        }\n    },\n    data() {\n        return {\n            hasChange: false,\n            hasInit: false,\n            tinymceId: this.id,\n            fullscreen: false\n        };\n    },\n    computed: {},\n    watch: {\n        value(val) {\n            if (!this.hasChange && this.hasInit) {\n                this.$nextTick(() =>\n                    window.tinymce.get(this.tinymceId).setContent(val || \"\")\n                );\n            }\n        }\n    },\n    mounted() {\n        this.initTinymce();\n    },\n    activated() {\n        this.initTinymce();\n    },\n    deactivated() {\n        this.destroyTinymce();\n    },\n    destroyed() {\n        this.destroyTinymce();\n    },\n    methods: {\n        initTinymce() {\n            const _this = this;\n            window.tinymce.init({\n                language: \"zh_CN\",\n                selector: `#${this.tinymceId}`,\n                convert_urls: false, // 让图片不自动设置成相对路径\n                height: this.height,\n                body_class: \"panel-body \",\n                object_resizing: false,\n                toolbar: this.toolbar.length > 0 ? this.toolbar : toolbar,\n                menubar: this.menubar,\n                plugins: plugins,\n                end_container_on_empty_block: true,\n                powerpaste_word_import: \"clean\",\n                code_dialog_height: 450,\n                code_dialog_width: 1000,\n                advlist_bullet_styles: \"square\",\n                advlist_number_styles: \"default\",\n                imagetools_cors_hosts: [\"www.tinymce.com\", \"codepen.io\"],\n                default_link_target: \"_blank\",\n                link_title: false,\n                nonbreaking_force_tab: true, // inserting nonbreaking space &nbsp; need Nonbreaking Space Plugin\n                init_instance_callback: editor => {\n                    if (_this.value) {\n                        editor.setContent(_this.value);\n                    }\n                    _this.hasInit = true;\n                    editor.on(\"NodeChange Change KeyUp SetContent\", () => {\n                        this.hasChange = true;\n                        this.$emit(\"input\", editor.getContent());\n                    });\n                },\n                setup(editor) {\n                    editor.on(\"FullscreenStateChanged\", e => {\n                        _this.fullscreen = e.state;\n                    });\n                },\n                // 整合七牛上传\n                // images_dataimg_filter(img) {\n                //   setTimeout(() => {\n                //     const $image = $(img);\n                //     $image.removeAttr('width');\n                //     $image.removeAttr('height');\n                //     if ($image[0].height && $image[0].width) {\n                //       $image.attr('data-wscntype', 'image');\n                //       $image.attr('data-wscnh', $image[0].height);\n                //       $image.attr('data-wscnw', $image[0].width);\n                //       $image.addClass('wscnph');\n                //     }\n                //   }, 0);\n                //   return img\n                // },\n                images_upload_handler(blobInfo, success, failure, progress) {\n                    progress(0);\n                    qiuNiuUpToken()\n                        .then(response => {\n                            if (response.code > 0) {\n                                failure(\"出现未知问题，刷新页面\");\n                                return;\n                            }\n                            const url = response.data.upload_url;\n                            const formData = new FormData();\n                            formData.append(\"token\", response.data.up_token);\n                            formData.append(\"file\", blobInfo.blob());\n                            const domain = response.data.domain;\n                            createFile(url, formData)\n                                .then(response => {\n                                    if (response.data.key) {\n                                        let path_url =\n                                            domain + \"/\" + response.data.key;\n                                        success(path_url);\n                                        progress(100);\n                                        return;\n                                    }\n                                    failure(\"上传出错\");\n                                })\n                                .catch(() => {\n                                    failure(\"上传出错\");\n                                });\n                        })\n                        .catch(err => {\n                            failure(\"出现未知问题，刷新页面\");\n                            console.log(err);\n                        });\n                }\n            });\n        },\n        destroyTinymce() {\n            if (window.tinymce.get(this.tinymceId)) {\n                window.tinymce.get(this.tinymceId).destroy();\n            }\n        },\n        setContent(value) {\n            window.tinymce.get(this.tinymceId).setContent(value);\n        },\n        getContent() {\n            window.tinymce.get(this.tinymceId).getContent();\n        }\n    }\n};\n</script>\n\n<style scoped>\n.tinymce-container {\n    position: relative;\n}\n.tinymce-container >>> .mce-fullscreen {\n    z-index: 10000;\n}\n.tinymce-textarea {\n    visibility: hidden;\n    z-index: -1;\n}\n.editor-custom-btn-container {\n    position: absolute;\n    right: 4px;\n    top: 4px;\n    /*z-index: 2005;*/\n}\n.fullscreen .editor-custom-btn-container {\n    z-index: 10000;\n    position: fixed;\n}\n.editor-upload-btn {\n    display: inline-block;\n}\n</style>\n"]}]}
{"remainingRequest":"/Users/quan/code/vue-admin-php/view/node_modules/thread-loader/dist/cjs.js!/Users/quan/code/vue-admin-php/view/node_modules/babel-loader/lib/index.js!/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/quan/code/vue-admin-php/view/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/quan/code/vue-admin-php/view/src/components/File/Upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/quan/code/vue-admin-php/view/src/components/File/Upload.vue","mtime":1648609501786},{"path":"/Users/quan/code/vue-admin-php/view/babel.config.js","mtime":1648609501757},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js","mtime":1614678925383},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/thread-loader/dist/cjs.js","mtime":1614678926780},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/babel-loader/lib/index.js","mtime":1648609858414},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js","mtime":1614678925383},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/vue-loader/lib/index.js","mtime":1648609878333}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { qiuNiuUpToken, createFile } from \"../../api/file/upload\";\nimport { renderSize } from \"../../filtres/index\";\nexport default {\n  name: \"Upload\",\n  props: {\n    height: {\n      type: Number\n    },\n    width: {\n      type: Number\n    },\n    ext: {\n      type: String\n    },\n    size: {\n      type: Number\n    },\n    color: {\n      type: String,\n      default: \"#1890ff\"\n    }\n  },\n  data: function data() {\n    return {\n      activeName: \"localhost\",\n      file: null,\n      fileName: \"\",\n      filePath: \"\",\n      filePathUrl: \"\",\n      fileUrl: \"\",\n      dialogVisible: false,\n      uploadLoading: false\n    };\n  },\n  methods: {\n    onDrag: function onDrag(e) {\n      e.stopPropagation();\n      e.preventDefault();\n    },\n    onDrop: function onDrop(e) {\n      e.stopPropagation();\n      e.preventDefault();\n      var data = e.dataTransfer.files; // 获取文件对象\n\n      if (data.length < 1) {\n        return false; // 检测是否有文件拖拽到页面\n      }\n\n      this.file = data[0];\n      this.fileName = data[0].name;\n    },\n    onChange: function onChange(e) {\n      var data = e.target.files; // 获取文件对象\n\n      if (data.length < 1) {\n        return false; // 检测是否有文件拖拽到页面\n      }\n\n      this.file = data[0];\n      this.fileName = data[0].name;\n      e.target.value = \"\";\n    },\n    onReset: function onReset() {\n      this.activeName = \"localhost\";\n      this.file = null;\n      this.fileName = \"\";\n      this.filePath = \"\";\n      this.filePathUrl = \"\";\n      this.fileUrl = \"\";\n      this.dialogVisible = false;\n      this.uploadLoading = false;\n    },\n    handleSubmit: function handleSubmit() {\n      var _this2 = this;\n\n      if (this.activeName === \"network\") {\n        if (!this.fileUrl) {\n          this.$message.error(\"请输入文件网络地址\");\n          return;\n        }\n\n        this.$emit(\"on-select\", this.fileUrl, this.fileUrl);\n        this.onReset();\n        return;\n      }\n\n      if (this.file === null) {\n        this.$message.error(\"请先选择文件\");\n        return;\n      } // 检查文件\n\n\n      var isVerify = this.beforeUpload(this.file);\n\n      if (isVerify === false) {\n        return;\n      }\n\n      isVerify.then(function () {\n        _this2.uploadLoading = true;\n        qiuNiuUpToken().then(function (response) {\n          if (response.code > 0) {\n            _this2.$message.error(\"出现未知问题，刷新页面\");\n\n            return;\n          }\n\n          var url = response.data.upload_url;\n          var formData = new FormData();\n          formData.append(\"token\", response.data.up_token);\n          formData.append(\"file\", _this2.file);\n          createFile(url, formData).then(function (response) {\n            _this2.uploadLoading = false;\n\n            if (response.key || response.data.key) {\n              var filePath = response.key || response.data.key;\n\n              var _URL = window.URL || window.webkitURL;\n\n              var filePathUrl = _URL.createObjectURL(_this2.file);\n\n              _this2.$emit(\"on-select\", filePath, filePathUrl);\n\n              _this2.onReset();\n\n              return;\n            }\n\n            _this2.$message.error(\"上传出错\");\n          }).catch(function () {\n            _this2.uploadLoading = false;\n\n            _this2.$message.error(\"上传出错\");\n          });\n        }).catch(function () {\n          _this2.uploadLoading = false;\n\n          _this2.$message.error(\"出现未知问题，刷新页面\");\n        });\n      }).catch(function () {});\n    },\n    beforeUpload: function beforeUpload(file) {\n      var name = file.name ? file.name : \"\";\n      var ext = name ? name.substr(name.lastIndexOf(\".\") + 1, name.length) : true; // 转成小写\n\n      ext = ext.toLowerCase();\n      var isExt = false; // 如果有坚持文件后缀的配置\n\n      if (this.ext) {\n        isExt = this.ext.indexOf(ext) >= 0;\n\n        if (!isExt) {\n          this.$message.error(\"文件只能为 \" + this.ext + \" 格式!\");\n          return false;\n        }\n      }\n\n      var isSize = false;\n\n      if (this.size) {\n        var sizeStr = this.size;\n        isSize = sizeStr > 0 && file.size > sizeStr;\n\n        if (isSize) {\n          this.$message.error(\"上传文件不能超过 \" + renderSize(sizeStr) + \"!\");\n          return false;\n        }\n      }\n\n      var _this = this;\n\n      if (_this.width || _this.height) {\n        return new Promise(function (resolve, reject) {\n          var width = _this.width;\n          var height = _this.height;\n\n          var _URL = window.URL || window.webkitURL;\n\n          var img = new Image();\n          img.src = _URL.createObjectURL(file);\n\n          img.onload = function () {\n            var valid = (!width || img.width === width) && (!height || img.height === height);\n\n            if (valid) {\n              resolve();\n            } else {\n              var messageStr = \"\";\n\n              if (width && !height) {\n                messageStr = width;\n              }\n\n              if (height && !width) {\n                messageStr = height;\n              }\n\n              if (height && width) {\n                messageStr = width + \"*\" + height;\n              }\n\n              _this.$message.error(\"上传尺寸必须是 \" + messageStr + \" px!\");\n\n              reject();\n            }\n          };\n        });\n      }\n\n      return new Promise(function (resolve) {\n        resolve();\n      });\n    }\n  },\n  computed: {},\n  watch: {}\n};",{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA;AACA;AAEA;AACAA,gBADA;AAEAC;AACAC;AACAC;AADA,KADA;AAIAC;AACAD;AADA,KAJA;AAOAE;AACAF;AADA,KAPA;AAUAG;AACAH;AADA,KAVA;AAaAI;AACAJ,kBADA;AAEAK;AAFA;AAbA,GAFA;AAoBAC,MApBA,kBAoBA;AACA;AACAC,6BADA;AAEAC,gBAFA;AAGAC,kBAHA;AAIAC,kBAJA;AAKAC,qBALA;AAMAC,iBANA;AAOAC,0BAPA;AAQAC;AARA;AAUA,GA/BA;AAgCAC;AACAC,UADA,kBACAC,CADA,EACA;AACAA;AACAA;AACA,KAJA;AAKAC,UALA,kBAKAD,CALA,EAKA;AACAA;AACAA;AACA,sCAHA,CAIA;;AACA;AACA,qBADA,CACA;AACA;;AACA;AACA;AACA,KAfA;AAgBAE,YAhBA,oBAgBAF,CAhBA,EAgBA;AACA,gCADA,CAEA;;AACA;AACA,qBADA,CACA;AACA;;AACA;AACA;AACAA;AACA,KAzBA;AA0BAG,WA1BA,qBA0BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAnCA;AAoCAC,gBApCA,0BAoCA;AAAA;;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA,OAbA,CAcA;;;AACA;;AACA;AACA;AACA;;AACAC,eACAC,IADA,CACA;AACA;AACAC,wBACAD,IADA,CACA;AACA;AACA;;AACA;AACA;;AACA;AACA;AACAE;AACAA;AACAC,oCACAH,IADA,CACA;AACA;;AACA;AACA,6BACAI,iCADA;;AAEA,yBACAC,8BADA;;AAEA,qDACA,WADA;;AAGA,2BACA,WADA,EAEAlB,QAFA,EAGAC,WAHA;;AAKA;;AACA;AACA;;AACA;AACA,WApBA,EAqBAkB,KArBA,CAqBA;AACA;;AACA;AACA,WAxBA;AAyBA,SAnCA,EAoCAA,KApCA,CAoCA;AACA;;AACA;AACA,SAvCA;AAwCA,OA3CA,EA4CAA,KA5CA,CA4CA,cA5CA;AA6CA,KApGA;AAqGAC,gBArGA,wBAqGAtB,IArGA,EAqGA;AACA;AACA,uBACAX,mDADA,GAEA,IAFA,CAFA,CAKA;;AACAK;AACA,wBAPA,CAQA;;AACA;AACA6B;;AACA;AACA;AACA;AACA;AACA;;AACA;;AACA;AACA;AACAC;;AACA;AACA,8BACA,uCADA;AAGA;AACA;AACA;;AACA;;AACA;AACA;AACA;AACA;;AACA;;AACA;AACAC;;AACAA;AACA,wBACA,oCACA,gCADA,CADA;;AAGA;AACAC;AACA,aAFA,MAEA;AACA;;AACA;AACAC;AACA;;AACA;AACAA;AACA;;AACA;AACAA;AACA;;AACAC,mCACA,gCADA;;AAGAC;AACA;AACA,WAtBA;AAuBA,SA7BA;AA8BA;;AACA;AACAH;AACA,OAFA;AAGA;AApKA,GAhCA;AAsMAI,cAtMA;AAuMAC;AAvMA","names":["name","props","height","type","width","ext","size","color","default","data","activeName","file","fileName","filePath","filePathUrl","fileUrl","dialogVisible","uploadLoading","methods","onDrag","e","onDrop","onChange","onReset","handleSubmit","isVerify","then","qiuNiuUpToken","formData","createFile","response","window","catch","beforeUpload","isExt","isSize","img","resolve","messageStr","_this","reject","computed","watch"],"sourceRoot":"src/components/File","sources":["Upload.vue"],"sourcesContent":["<template>\n    <div class=\"upload-container\">\n        <el-button :style=\"{background:color,borderColor:color}\"\n                   icon=\"el-icon-upload\"\n                   size=\"mini\"\n                   type=\"primary\"\n                   @click=\" dialogVisible=true\">上传文件</el-button>\n\n\n        <el-dialog\n            custom-class=\"upload-dialog__body\"\n            width=\"450px\"\n            title=\"插入图片\"\n            :visible.sync=\"dialogVisible\"\n            append-to-body>\n\n            <el-tabs v-model=\"activeName\">\n                <el-tab-pane label=\"本地上传\" name=\"localhost\">\n                    <div class=\"upload-content\">\n                        <span class=\"text-muted\">只能上传{{ ext }}文件，且大小不超过{{ size | renderSize }}，且宽高 {{ width ? width + 'px' : \"不限\" }} * {{ height ? height + 'px' : \"不限\" }}</span>\n                        <br>\n                        <div class=\"widget-upload\" @dragenter=\"onDrag\" @dragover=\"onDrag\" @drop=\"onDrop\">\n                            <input type=\"file\" ref=\"upload\" name=\"file\" class=\"widget-upload__file\" @change=\"onChange\">\n                            <el-input\n                                class=\"widget-upload__text\"\n                                size=\"medium\"\n                                placeholder=\"文件拖拽到这里\"\n                                v-model=\"fileName\">\n                            </el-input>\n                            <el-button size=\"medium\">选择文件</el-button>\n                        </div>\n                    </div>\n                </el-tab-pane>\n                <el-tab-pane label=\"远程地址获取\" name=\"network\">\n                    <div class=\"upload-content\">\n                        <span class=\"text-muted\">只能上传{{ ext }}文件，且大小不超过{{ size | renderSize }}，且宽高 {{ width ? width + 'px' : \"不限\" }} * {{ height ? height + 'px' : \"不限\" }}</span>\n                        <br>\n                        <div class=\"widget-upload\">\n                            <el-input\n                                size=\"medium\"\n                                placeholder=\"请输入文件所在网址\"\n                                v-model=\"fileUrl\">\n                            </el-input>\n                        </div>\n                    </div>\n                </el-tab-pane>\n            </el-tabs>\n\n            <div style=\"text-align: right;padding-top: 40px;\">\n                <el-button size=\"medium\" @click=\"dialogVisible = false\">取 消</el-button>\n                <el-button size=\"medium\" type=\"primary\" @click=\"handleSubmit\" :loading=\"uploadLoading\">插入</el-button>\n            </div>\n\n        </el-dialog>\n\n    </div>\n</template>\n\n<script>\nimport { qiuNiuUpToken, createFile } from \"../../api/file/upload\";\nimport { renderSize } from \"../../filtres/index\";\n\nexport default {\n    name: \"Upload\",\n    props: {\n        height: {\n            type: Number\n        },\n        width: {\n            type: Number\n        },\n        ext: {\n            type: String\n        },\n        size: {\n            type: Number\n        },\n        color: {\n            type: String,\n            default: \"#1890ff\"\n        }\n    },\n    data() {\n        return {\n            activeName: \"localhost\",\n            file: null,\n            fileName: \"\",\n            filePath: \"\",\n            filePathUrl: \"\",\n            fileUrl: \"\",\n            dialogVisible: false,\n            uploadLoading: false\n        };\n    },\n    methods: {\n        onDrag(e) {\n            e.stopPropagation();\n            e.preventDefault();\n        },\n        onDrop(e) {\n            e.stopPropagation();\n            e.preventDefault();\n            const data = e.dataTransfer.files;\n            // 获取文件对象\n            if (data.length < 1) {\n                return false; // 检测是否有文件拖拽到页面\n            }\n            this.file = data[0];\n            this.fileName = data[0].name;\n        },\n        onChange(e) {\n            const data = e.target.files;\n            // 获取文件对象\n            if (data.length < 1) {\n                return false; // 检测是否有文件拖拽到页面\n            }\n            this.file = data[0];\n            this.fileName = data[0].name;\n            e.target.value = \"\";\n        },\n        onReset() {\n            this.activeName = \"localhost\";\n            this.file = null;\n            this.fileName = \"\";\n            this.filePath = \"\";\n            this.filePathUrl = \"\";\n            this.fileUrl = \"\";\n            this.dialogVisible = false;\n            this.uploadLoading = false;\n        },\n        handleSubmit() {\n            if (this.activeName === \"network\") {\n                if (!this.fileUrl) {\n                    this.$message.error(\"请输入文件网络地址\");\n                    return;\n                }\n                this.$emit(\"on-select\", this.fileUrl, this.fileUrl);\n                this.onReset();\n                return;\n            }\n            if (this.file === null) {\n                this.$message.error(\"请先选择文件\");\n                return;\n            }\n            // 检查文件\n            let isVerify = this.beforeUpload(this.file);\n            if (isVerify === false) {\n                return;\n            }\n            isVerify\n                .then(() => {\n                    this.uploadLoading = true;\n                    qiuNiuUpToken()\n                        .then(response => {\n                            if (response.code > 0) {\n                                this.$message.error(\"出现未知问题，刷新页面\");\n                                return;\n                            }\n                            const url = response.data.upload_url;\n                            const formData = new FormData();\n                            formData.append(\"token\", response.data.up_token);\n                            formData.append(\"file\", this.file);\n                            createFile(url, formData)\n                                .then(response => {\n                                    this.uploadLoading = false;\n                                    if (response.key || response.data.key) {\n                                        const filePath =\n                                            response.key || response.data.key;\n                                        let _URL =\n                                            window.URL || window.webkitURL;\n                                        const filePathUrl = _URL.createObjectURL(\n                                            this.file\n                                        );\n                                        this.$emit(\n                                            \"on-select\",\n                                            filePath,\n                                            filePathUrl\n                                        );\n                                        this.onReset();\n                                        return;\n                                    }\n                                    this.$message.error(\"上传出错\");\n                                })\n                                .catch(() => {\n                                    this.uploadLoading = false;\n                                    this.$message.error(\"上传出错\");\n                                });\n                        })\n                        .catch(() => {\n                            this.uploadLoading = false;\n                            this.$message.error(\"出现未知问题，刷新页面\");\n                        });\n                })\n                .catch(() => {});\n        },\n        beforeUpload(file) {\n            const name = file.name ? file.name : \"\";\n            let ext = name\n                ? name.substr(name.lastIndexOf(\".\") + 1, name.length)\n                : true;\n            // 转成小写\n            ext = ext.toLowerCase();\n            let isExt = false;\n            // 如果有坚持文件后缀的配置\n            if (this.ext) {\n                isExt = this.ext.indexOf(ext) >= 0;\n                if (!isExt) {\n                    this.$message.error(\"文件只能为 \" + this.ext + \" 格式!\");\n                    return false;\n                }\n            }\n            let isSize = false;\n            if (this.size) {\n                let sizeStr = this.size;\n                isSize = sizeStr > 0 && file.size > sizeStr;\n                if (isSize) {\n                    this.$message.error(\n                        \"上传文件不能超过 \" + renderSize(sizeStr) + \"!\"\n                    );\n                    return false;\n                }\n            }\n            const _this = this;\n            if (_this.width || _this.height) {\n                return new Promise(function(resolve, reject) {\n                    let width = _this.width;\n                    let height = _this.height;\n                    let _URL = window.URL || window.webkitURL;\n                    let img = new Image();\n                    img.src = _URL.createObjectURL(file);\n                    img.onload = function() {\n                        let valid =\n                            (!width || img.width === width) &&\n                            (!height || img.height === height);\n                        if (valid) {\n                            resolve();\n                        } else {\n                            let messageStr = \"\";\n                            if (width && !height) {\n                                messageStr = width;\n                            }\n                            if (height && !width) {\n                                messageStr = height;\n                            }\n                            if (height && width) {\n                                messageStr = width + \"*\" + height;\n                            }\n                            _this.$message.error(\n                                \"上传尺寸必须是 \" + messageStr + \" px!\"\n                            );\n                            reject();\n                        }\n                    };\n                });\n            }\n            return new Promise(function(resolve) {\n                resolve();\n            });\n        }\n    },\n    computed: {},\n    watch: {}\n};\n</script>\n\n<style type=\"text/scss\" lang=\"scss\">\n.upload-dialog__body {\n    .el-dialog__header {\n        background-color: #f3f3f3;\n        border-top-left-radius: 6px;\n        border-top-right-radius: 6px;\n    }\n    .el-dialog__body {\n        padding: 12px 20px !important;\n    }\n}\n.upload-content {\n    padding-top: 15px;\n    .widget-upload {\n        position: relative;\n    }\n    .widget-upload__text {\n        width: 66.66%;\n        padding-right: 15px;\n        .el-input__inner {\n            border: 1px solid #ccc;\n            background-color: #eee;\n        }\n    }\n    .widget-upload {\n        padding-top: 5px;\n        .widget-upload__file {\n            position: absolute;\n            opacity: 0;\n            width: 85%;\n            height: 100%;\n            z-index: 10;\n            cursor: pointer;\n        }\n    }\n}\n</style>\n"]}]}
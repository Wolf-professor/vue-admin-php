{"remainingRequest":"/Users/quan/code/vue-admin-php/view/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/quan/code/vue-admin-php/view/src/views/adManage/adSite.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/quan/code/vue-admin-php/view/src/views/adManage/adSite.vue","mtime":1648609501798},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/babel-loader/lib/index.js","mtime":1648609858414},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/cache-loader/dist/cjs.js","mtime":1614678925383},{"path":"/Users/quan/code/vue-admin-php/view/node_modules/vue-loader/lib/index.js","mtime":1648609878333}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n    adSiteList,\n    adSiteAdList,\n    adSiteSave,\n    adSiteDelete\n} from \"../../api/ad/adSite\";\nimport draggable from \"vuedraggable\";\nconst formJson = {\n    site_id: \"\",\n    site_name: \"\",\n    describe: \"\",\n    ads: []\n};\nexport default {\n    data() {\n        return {\n            query: {\n                site_id: \"\",\n                page: 1,\n                limit: 20\n            },\n            list: [],\n            adId: [],\n            adSelectList: [],\n            adList: {},\n            adListNoDataText: \"无数据\",\n            queryAdIdAsyncLoading: false,\n            total: 0,\n            loading: true,\n            index: null,\n            formName: null,\n            formMap: {\n                add: \"新增\",\n                edit: \"编辑\"\n            },\n            formLoading: false,\n            formVisible: false,\n            formData: formJson,\n            formRules: {\n                site_name: [\n                    {\n                        required: true,\n                        message: \"请输入广告位名称\",\n                        trigger: \"blur\"\n                    }\n                ]\n            },\n            deleteLoading: false\n        };\n    },\n    components: {\n        draggable\n    },\n    methods: {\n        onReset() {\n            this.$router.push({\n                path: \"\"\n            });\n            this.query = {\n                site_id: \"\",\n                page: 1,\n                limit: 20\n            };\n            this.getList();\n        },\n        onSubmit() {\n            this.$router.push({\n                path: \"\",\n                query: this.query\n            });\n            this.getList();\n        },\n        handleSizeChange(val) {\n            this.query.limit = val;\n            this.getList();\n        },\n        handleCurrentChange(val) {\n            this.query.page = val;\n            this.getList();\n        },\n        getList() {\n            this.loading = true;\n            adSiteList(this.query)\n                .then(response => {\n                    this.loading = false;\n                    this.list = response.data.list || [];\n                    this.total = response.data.total || 0;\n                })\n                .catch(() => {\n                    this.loading = false;\n                    this.list = [];\n                    this.total = 0;\n                });\n        },\n        // 异步查找广告\n        queryAdIdAsync(adIdStr) {\n            this.adListNoDataText = \"请确认广告状态是否正常\";\n            if (!adIdStr || adIdStr.charAt(adIdStr.length - 1) === \",\") {\n                this.adList = {};\n                return false;\n            }\n            let adIds = adIdStr.split(\",\");\n            this.formData.ads.forEach(item => {\n                adIds.forEach((obj, index) => {\n                    if (item.ad_id === parseInt(obj)) {\n                        adIds.splice(index, 1);\n                    }\n                });\n            });\n            if (adIds.length === 0) {\n                this.adListNoDataText = \"当前所有广告已存在列表中\";\n                return false;\n            }\n            this.queryAdIdAsyncLoading = true;\n            adSiteAdList({ ad_ids: adIds })\n                .then(response => {\n                    this.queryAdIdAsyncLoading = false;\n                    let list = response.data.list;\n                    if (list) {\n                        list.forEach(value => {\n                            let has = false;\n                            if (this.adList.length > 0) {\n                                has = this.adList.some(item => {\n                                    return item.ad_id === value.ad_id;\n                                });\n                            }\n                            if (!has) {\n                                if (!this.adList.hasOwnProperty(value.ad_id)) {\n                                    this.adList[value.ad_id] = value;\n                                }\n                            }\n                        });\n                    } else {\n                        this.adList = {};\n                    }\n                })\n                .catch(() => {\n                    this.adList = {};\n                    this.queryAdIdAsyncLoading = false;\n                });\n        },\n        handleAdSubmit() {\n            if (this.adSelectList.length === 0) {\n                return false;\n            }\n            let ads = [];\n            this.adSelectList.map(item => {\n                if (this.adList.hasOwnProperty(item)) {\n                    ads.push(this.adList[item]);\n                }\n            });\n            this.formData.ads = this.formData.ads.concat(ads);\n            this.adList = {};\n            this.adId = [];\n        },\n        handleAdClose(index) {\n            this.formData.ads.splice(index, 1);\n        },\n        handleAdChange(item) {\n            this.adSelectList = item;\n        },\n        // 刷新表单\n        resetForm() {\n            if (this.$refs[\"dataForm\"]) {\n                // 清空验证信息表单\n                this.$refs[\"dataForm\"].clearValidate();\n                // 刷新表单\n                this.$refs[\"dataForm\"].resetFields();\n            }\n        },\n        // 隐藏表单\n        hideForm() {\n            // 更改值\n            this.formVisible = !this.formVisible;\n            return true;\n        },\n        // 显示表单\n        handleForm(index, row) {\n            this.formVisible = true;\n            this.formData = JSON.parse(JSON.stringify(formJson));\n            if (row !== null) {\n                this.formData = Object.assign({}, row);\n            }\n            this.formName = \"add\";\n            if (index !== null) {\n                this.index = index;\n                this.formName = \"edit\";\n            }\n        },\n        formSubmit() {\n            this.$refs[\"dataForm\"].validate(valid => {\n                if (valid) {\n                    this.formLoading = true;\n                    let data = Object.assign({}, this.formData);\n                    let ad_ids = [];\n                    let ads = data.ads;\n                    ads.forEach(function(value) {\n                        ad_ids.push(value.ad_id);\n                    });\n                    data.ads = [];\n                    data.ad_ids = ad_ids;\n                    let addData = Object.assign({}, this.formData);\n                    adSiteSave(data, this.formName)\n                        .then(response => {\n                            this.formLoading = false;\n                            if (response.code) {\n                                this.$message.error(response.message);\n                                return false;\n                            }\n                            this.$message.success(\"操作成功\");\n                            this.formVisible = false;\n                            if (this.formName === \"add\") {\n                                // 向头部添加数据\n                                addData.site_id = response.data.site_id;\n                                this.list.unshift(addData);\n                            } else {\n                                this.list.splice(this.index, 1, addData);\n                            }\n                            // 刷新表单\n                            this.resetForm();\n                        })\n                        .catch(() => {\n                            this.formLoading = false;\n                        });\n                }\n            });\n        },\n        // 删除\n        handleDel(index, row) {\n            if (row.site_id) {\n                this.$confirm(\"确认删除该记录吗?\", \"提示\", {\n                    type: \"warning\"\n                })\n                    .then(() => {\n                        let para = { site_id: row.site_id };\n                        this.deleteLoading = false;\n                        adSiteDelete(para)\n                            .then(res => {\n                                this.deleteLoading = false;\n                                if (res.code) {\n                                    this.$message.error(res.message);\n                                    return false;\n                                }\n                                this.$message.success(\"删除成功\");\n                                // 刷新数据\n                                this.list.splice(index, 1);\n                            })\n                            .catch(() => {\n                                this.deleteLoading = false;\n                            });\n                    })\n                    .catch(() => {\n                        this.$message.info(\"取消删除\");\n                    });\n            }\n        }\n    },\n    filters: {},\n    mounted() {\n        document.body.ondrop = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n        };\n    },\n    created() {\n        // 将参数拷贝进查询对象\n        let query = this.$route.query;\n        this.query = Object.assign(this.query, query);\n        this.query.limit = parseInt(this.query.limit);\n        // 加载表格数据\n        this.getList();\n    }\n};\n",{"version":3,"sources":["adSite.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"adSite.vue","sourceRoot":"src/views/adManage","sourcesContent":["<template>\n\n    <div>\n        <el-form :inline=\"true\" :model=\"query\" class=\"query-form\" size=\"mini\">\n            <el-form-item class=\"query-form-item\">\n                <el-input v-model=\"query.site_id\" placeholder=\"广告位id\"></el-input>\n            </el-form-item>\n            <el-form-item>\n                <el-button-group>\n                    <el-button type=\"primary\" icon=\"el-icon-refresh\" @click=\"onReset\"></el-button>\n                    <el-button type=\"primary\" icon=\"search\" @click=\"onSubmit\">查询</el-button>\n                    <el-button type=\"primary\" @click.native=\"handleForm(null,null)\">新增</el-button>\n                </el-button-group>\n            </el-form-item>\n        </el-form>\n        <el-table\n            v-loading=\"loading\"\n            :data=\"list\"\n            style=\"width: 100%;\">\n            <el-table-column\n                label=\"ID\"\n                prop=\"site_id\"\n                fixed>\n            </el-table-column>\n            <el-table-column\n                label=\"广告位名称\"\n                prop=\"site_name\"\n                fixed>\n            </el-table-column>\n            <el-table-column\n                label=\"广告位描述\"\n                prop=\"describe\"\n                with=\"300\"\n                :show-overflow-tooltip=\"true\">\n            </el-table-column>\n            <el-table-column\n                label=\"最后更新时间\"\n                prop=\"update_time\">\n                <template slot-scope=\"scope\">\n                    <i class=\"el-icon-time\"></i>\n                    <span>{{ scope.row.modified_time }}</span>\n                </template>\n            </el-table-column>\n            <el-table-column\n                label=\"操作\"\n                fixed=\"right\">\n                <template slot-scope=\"scope\">\n                    <el-button type=\"text\" size=\"small\" @click.native=\"handleForm(scope.$index, scope.row)\">编辑</el-button>\n                    <el-button type=\"text\" size=\"small\" @click.native=\"handleDel(scope.$index, scope.row)\">删除</el-button>\n                </template>\n            </el-table-column>\n        </el-table>\n\n        <el-pagination\n            :page-size=\"query.limit\"\n            @current-change=\"handleCurrentChange\"\n            layout=\"prev, pager, next\"\n            :total=\"total\">\n        </el-pagination>\n\n        <!--表单-->\n        <el-dialog\n            :title=\"formMap[formName]\"\n            :visible.sync=\"formVisible\"\n            :before-close=\"hideForm\"\n            width=\"85%\"\n            top=\"5vh\">\n            <el-form :model=\"formData\" :rules=\"formRules\" ref=\"dataForm\">\n                <el-form-item label=\"广告位名称\" prop=\"site_name\">\n                    <el-input v-model=\"formData.site_name\" auto-complete=\"off\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"包含广告（拖动更改排序）\" prop=\"describe\">\n                    <span style=\"color: red;\">注意：广告列表中红色背景为已禁用</span>\n                    <div class=\"remove-list-box\">\n                        <div class=\"remove-list\">\n\n                            <draggable element=\"ul\" v-model=\"formData.ads\">\n                                <li class=\"remove-list-item\" style=\"cursor: move;\" :style=\"{backgroundColor: item.status === 1 ? '#fff' : '#fef0f0', color: item.status === 1 ? '#606266' : '#f56c6c'}\" v-for=\"(item, index) in formData.ads\" :key=\"index\">\n                                    {{item.title}} - {{item.describe}}（ID：{{item.ad_id}}）\n                                    <i class=\"el-icon-close remove-list-close\" @click=\"handleAdClose(index)\"></i>\n                                </li>\n                            </draggable>\n\n                        </div>\n                        添加广告（填写广告ID，批量添加以英文逗号隔开，按顺序排列）\n                        <el-select\n                            size=\"mini\"\n                            v-model=\"adId\"\n                            multiple\n                            filterable\n                            remote\n                            reserve-keyword\n                            placeholder=\"输入广告ID查找\"\n                            :no-data-text=\"adListNoDataText\"\n                            :remote-method=\"queryAdIdAsync\"\n                            @change=\"handleAdChange\"\n                            :loading=\"queryAdIdAsyncLoading\">\n                            <el-option\n                                v-for=\"item in adList\"\n                                :key=\"item.ad_id\"\n                                :label=\"item.title\"\n                                :value=\"item.ad_id\">\n                            </el-option>\n                        </el-select>\n                        <el-button type=\"primary\" size=\"mini\" @click.native=\"handleAdSubmit()\" style=\"margin-left: 5px;\">插入</el-button>\n                    </div>\n                </el-form-item>\n                <el-form-item label=\"描述\" prop=\"describe\">\n                    <el-input v-model=\"formData.describe\" auto-complete=\"off\"></el-input>\n                </el-form-item>\n            </el-form>\n            <div slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click.native=\"hideForm\">取消</el-button>\n                <el-button type=\"primary\" @click.native=\"formSubmit()\" :loading=\"formLoading\">提交</el-button>\n            </div>\n        </el-dialog>\n\n    </div>\n\n</template>\n\n<script>\nimport {\n    adSiteList,\n    adSiteAdList,\n    adSiteSave,\n    adSiteDelete\n} from \"../../api/ad/adSite\";\nimport draggable from \"vuedraggable\";\nconst formJson = {\n    site_id: \"\",\n    site_name: \"\",\n    describe: \"\",\n    ads: []\n};\nexport default {\n    data() {\n        return {\n            query: {\n                site_id: \"\",\n                page: 1,\n                limit: 20\n            },\n            list: [],\n            adId: [],\n            adSelectList: [],\n            adList: {},\n            adListNoDataText: \"无数据\",\n            queryAdIdAsyncLoading: false,\n            total: 0,\n            loading: true,\n            index: null,\n            formName: null,\n            formMap: {\n                add: \"新增\",\n                edit: \"编辑\"\n            },\n            formLoading: false,\n            formVisible: false,\n            formData: formJson,\n            formRules: {\n                site_name: [\n                    {\n                        required: true,\n                        message: \"请输入广告位名称\",\n                        trigger: \"blur\"\n                    }\n                ]\n            },\n            deleteLoading: false\n        };\n    },\n    components: {\n        draggable\n    },\n    methods: {\n        onReset() {\n            this.$router.push({\n                path: \"\"\n            });\n            this.query = {\n                site_id: \"\",\n                page: 1,\n                limit: 20\n            };\n            this.getList();\n        },\n        onSubmit() {\n            this.$router.push({\n                path: \"\",\n                query: this.query\n            });\n            this.getList();\n        },\n        handleSizeChange(val) {\n            this.query.limit = val;\n            this.getList();\n        },\n        handleCurrentChange(val) {\n            this.query.page = val;\n            this.getList();\n        },\n        getList() {\n            this.loading = true;\n            adSiteList(this.query)\n                .then(response => {\n                    this.loading = false;\n                    this.list = response.data.list || [];\n                    this.total = response.data.total || 0;\n                })\n                .catch(() => {\n                    this.loading = false;\n                    this.list = [];\n                    this.total = 0;\n                });\n        },\n        // 异步查找广告\n        queryAdIdAsync(adIdStr) {\n            this.adListNoDataText = \"请确认广告状态是否正常\";\n            if (!adIdStr || adIdStr.charAt(adIdStr.length - 1) === \",\") {\n                this.adList = {};\n                return false;\n            }\n            let adIds = adIdStr.split(\",\");\n            this.formData.ads.forEach(item => {\n                adIds.forEach((obj, index) => {\n                    if (item.ad_id === parseInt(obj)) {\n                        adIds.splice(index, 1);\n                    }\n                });\n            });\n            if (adIds.length === 0) {\n                this.adListNoDataText = \"当前所有广告已存在列表中\";\n                return false;\n            }\n            this.queryAdIdAsyncLoading = true;\n            adSiteAdList({ ad_ids: adIds })\n                .then(response => {\n                    this.queryAdIdAsyncLoading = false;\n                    let list = response.data.list;\n                    if (list) {\n                        list.forEach(value => {\n                            let has = false;\n                            if (this.adList.length > 0) {\n                                has = this.adList.some(item => {\n                                    return item.ad_id === value.ad_id;\n                                });\n                            }\n                            if (!has) {\n                                if (!this.adList.hasOwnProperty(value.ad_id)) {\n                                    this.adList[value.ad_id] = value;\n                                }\n                            }\n                        });\n                    } else {\n                        this.adList = {};\n                    }\n                })\n                .catch(() => {\n                    this.adList = {};\n                    this.queryAdIdAsyncLoading = false;\n                });\n        },\n        handleAdSubmit() {\n            if (this.adSelectList.length === 0) {\n                return false;\n            }\n            let ads = [];\n            this.adSelectList.map(item => {\n                if (this.adList.hasOwnProperty(item)) {\n                    ads.push(this.adList[item]);\n                }\n            });\n            this.formData.ads = this.formData.ads.concat(ads);\n            this.adList = {};\n            this.adId = [];\n        },\n        handleAdClose(index) {\n            this.formData.ads.splice(index, 1);\n        },\n        handleAdChange(item) {\n            this.adSelectList = item;\n        },\n        // 刷新表单\n        resetForm() {\n            if (this.$refs[\"dataForm\"]) {\n                // 清空验证信息表单\n                this.$refs[\"dataForm\"].clearValidate();\n                // 刷新表单\n                this.$refs[\"dataForm\"].resetFields();\n            }\n        },\n        // 隐藏表单\n        hideForm() {\n            // 更改值\n            this.formVisible = !this.formVisible;\n            return true;\n        },\n        // 显示表单\n        handleForm(index, row) {\n            this.formVisible = true;\n            this.formData = JSON.parse(JSON.stringify(formJson));\n            if (row !== null) {\n                this.formData = Object.assign({}, row);\n            }\n            this.formName = \"add\";\n            if (index !== null) {\n                this.index = index;\n                this.formName = \"edit\";\n            }\n        },\n        formSubmit() {\n            this.$refs[\"dataForm\"].validate(valid => {\n                if (valid) {\n                    this.formLoading = true;\n                    let data = Object.assign({}, this.formData);\n                    let ad_ids = [];\n                    let ads = data.ads;\n                    ads.forEach(function(value) {\n                        ad_ids.push(value.ad_id);\n                    });\n                    data.ads = [];\n                    data.ad_ids = ad_ids;\n                    let addData = Object.assign({}, this.formData);\n                    adSiteSave(data, this.formName)\n                        .then(response => {\n                            this.formLoading = false;\n                            if (response.code) {\n                                this.$message.error(response.message);\n                                return false;\n                            }\n                            this.$message.success(\"操作成功\");\n                            this.formVisible = false;\n                            if (this.formName === \"add\") {\n                                // 向头部添加数据\n                                addData.site_id = response.data.site_id;\n                                this.list.unshift(addData);\n                            } else {\n                                this.list.splice(this.index, 1, addData);\n                            }\n                            // 刷新表单\n                            this.resetForm();\n                        })\n                        .catch(() => {\n                            this.formLoading = false;\n                        });\n                }\n            });\n        },\n        // 删除\n        handleDel(index, row) {\n            if (row.site_id) {\n                this.$confirm(\"确认删除该记录吗?\", \"提示\", {\n                    type: \"warning\"\n                })\n                    .then(() => {\n                        let para = { site_id: row.site_id };\n                        this.deleteLoading = false;\n                        adSiteDelete(para)\n                            .then(res => {\n                                this.deleteLoading = false;\n                                if (res.code) {\n                                    this.$message.error(res.message);\n                                    return false;\n                                }\n                                this.$message.success(\"删除成功\");\n                                // 刷新数据\n                                this.list.splice(index, 1);\n                            })\n                            .catch(() => {\n                                this.deleteLoading = false;\n                            });\n                    })\n                    .catch(() => {\n                        this.$message.info(\"取消删除\");\n                    });\n            }\n        }\n    },\n    filters: {},\n    mounted() {\n        document.body.ondrop = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n        };\n    },\n    created() {\n        // 将参数拷贝进查询对象\n        let query = this.$route.query;\n        this.query = Object.assign(this.query, query);\n        this.query.limit = parseInt(this.query.limit);\n        // 加载表格数据\n        this.getList();\n    }\n};\n</script>\n\n<style type=\"text/scss\" lang=\"scss\">\n</style>\n"]}]}